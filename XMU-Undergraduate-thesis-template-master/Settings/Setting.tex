% !TeX root = ../Main/XMU.tex
\usepackage{amsmath,amsthm,amsfonts}  % 数学公式和字体
\usepackage{verbatim}  % 插入代码或注释
\usepackage{ifthen}  % 逻辑判断
\usepackage{xcolor}  % 加颜色
\usepackage{multirow}  % 做表格，合并多列表  
\usepackage[para]{threeparttable}  %  三段表
\usepackage{array,booktabs,longtable,tabularx}  % 做表格
\usepackage[font={small,bf}]{caption}  % 表名
\usepackage{graphicx}  % 插图(pdf)
\usepackage{listings}  %设置代码的插入
\usepackage{setspace}  % 使用间距宏包
\usepackage{pifont}  % 为了改变注脚
\usepackage[
	a4paper,
	left=2.5cm,
	right=2.5cm,
	top=3cm,
	bottom=4cm,
	footskip=1.5cm,
	twoside]
{geometry} % bindingoffset=1cm
\usepackage{tikz}  % 画图包
\usepackage{algorithm}  % 算法包
\usepackage[noend]{algpseudocode}  % 算法包
\usepackage{fontspec} 
% \usepackage{xeCJK}
%\usepackage[super,gbpub=false]{gbt7714}
\usepackage[sort,compress,style=gbt7714,gbpub=false,gbnoauthor=false,super]{biblatex}
\usepackage{fancyhdr}
\usepackage[bookmarks=true,bookmarksnumbered=false,colorlinks,linkcolor=black,citecolor=blue,urlcolor=green]{hyperref}
\usepackage{cleveref}



% --------------------------- resources settings ----------------------
\graphicspath{{../Figures/} } %设定图片的存放路径

% --------------------------- circled text settings ----------------------
% required package(s):
% - tikz
\newcommand*{\circled}[1]{\tikz[baseline=(char.base)]{\node[shape=circle,draw,inner sep=1pt] (char) {#1};}}  % define a new command for circled text since \textcircled is very sloppy

% --------------------------- endnotes settings ----------------------
% required package(s):
% - pifont
\renewcommand\thefootnote{\ding{\numexpr171+\value{footnote}}} %改变注脚的格式

% --------------------------- code inserting settings ----------------------
% required package(s):
% - listings
\def\lstbasicfont{\fontfamily{pcr}\selectfont\footnotesize}
\lstset{%
	numbers=left,
	numberstyle=\tiny,
	basicstyle=\small,
	backgroundcolor=\color{white},      % choose the background color
	basicstyle=\footnotesize\ttfamily,  % size of fonts used for the code
	columns=fullflexible,
	tabsize=4,
	breaklines=true,               % automatic line breaking only at whitespace
	captionpos=b,                  % sets the caption-position to bottom
	commentstyle=\color{green},  % comment style
	escapeinside={\%*}{*)},        % if you want to add LaTeX within your code
	keywordstyle=\color{blue},     % keyword style
	stringstyle=\color{purple}\ttfamily,  % string literal style
	frame=single,
	rulesepcolor=\color{red!20!green!20!blue!20},
}
\lstloadlanguages{C,C++,Java,Matlab,Mathematica}  % supported languages

% --------------------------- algorithm inserting settings ----------------------
% required packages:
% - algorithm
% - algpseudocode[noend]
\makeatletter
\def\algbackskip{\hskip-\ALG@thistlm} %\def\BState{\State\hskip-\ALG@thistlm} % both works fine, but latter one redefines \BState
\makeatother


% --------------------------- font settings ----------------------
% required packages
% - fontspec
% - xeCJK
\ctexset{today=big}  % format date
% Chinese Charactors Support
%		Windows OS Reqiured, Mac users please commented out these codes
\setCJKmainfont[ItalicFont={楷体}, BoldFont={黑体}]{宋体} %衬线字体 缺省中文字体为
\setCJKsansfont{黑体}  % 中文无衬线字体，即\sffamily
\setCJKmonofont{楷体}  % 中文等宽字体，即\ttfamily
%		Mac OS Reqiured, Windows users please commented out these codes
% \setCJKmainfont[ItalicFont={Kai}, BoldFont={Hei}]{STSong}%衬线字体 缺省中文字体为
% \setCJKsansfont{Hei}
% \setCJKmonofont{Kai}%中文等宽字体

% English Charactors Support
\setmainfont{Times New Roman} %西文部分默认使用的字体 [BoldFont=Nimbus Sans L, ItalicFont={Nimbus Roman No9 L}]
\setsansfont{Times New Roman} %西文默认无衬线字体
\setmonofont{Times New Roman} %西文默认的等宽字体

% -------------------------- redefine font size ----------------------
\newcommand{\xiaochu}{\fontsize{30pt}{40pt}\selectfont}    % 小初, 1.5倍行距
\newcommand{\yihao}{\fontsize{26pt}{36pt}\selectfont}    % 一号, 1.4倍行距
\newcommand{\erhao}{\fontsize{22pt}{28pt}\selectfont}    % 二号, 1.25倍行距
\newcommand{\xiaoer}{\fontsize{18pt}{18pt}\selectfont}    % 小二, 单倍行距
\newcommand{\sanhao}{\fontsize{16pt}{24pt}\selectfont}    % 三号, 1.5倍行距
\newcommand{\xiaosan}{\fontsize{15pt}{22pt}\selectfont}    % 小三, 1.5倍行距
\newcommand{\sihao}{\fontsize{14pt}{21pt}\selectfont}    % 四号, 1.5倍行距
\newcommand{\banxiaosi}{\fontsize{13pt}{19.5pt}\selectfont}    % 半小四, 1.5倍行距
\newcommand{\xiaosi}{\fontsize{12pt}{18pt}\selectfont}    % 小四, 1.5倍行距
\newcommand{\dawuhao}{\fontsize{11pt}{11pt}\selectfont}    % 大五号, 单倍行距
\newcommand{\wuhao}{\fontsize{10.5pt}{10.5pt}\selectfont}    % 五号, 单倍行距
\newcommand{\xiaowu}{\fontsize{9pt}{9pt}\selectfont}    % 小五号, 单倍行距


% --------------------------- cite settings ----------------------
% required packages:
% - xcolor
% - natbib[sort&compress]
% - hyperref[bookmarks=true,bookmarksnumbered=false,colorlinks,linkcolor=black,citecolor=blue,urlcolor=green]
\renewcommand{\citep}[1]{{\color{blue}\citeauthor{#1}(\citeyearpar{#1})}}

% --------------------------- reference settings ------------------------
% required packages:
% - cleveref
% \crefname params: 
% first: type
% second: singular cross reference
% third: plural cross reference
\crefformat{figure}{#2图#1#3}
\crefrangeformat{figure}{图(#3#1#4)\;$\sim$\;(#5#2#6)}
\crefmultiformat{figure}{图~(#2#1#3)}{和~(#2#1#3)}{，(#2#1#3)}{和~(#2#1#3)}

\crefformat{table}{#2表#1#3}
\crefrangeformat{table}{表(#3#1#4)\;$\sim$\;(#5#2#6)}
\crefmultiformat{table}{表~(#2#1#3)}{和~(#2#1#3)}{，(#2#1#3)}{和~(#2#1#3)}

\crefformat{equation}{公式(#2#1#3)}
\crefrangeformat{equation}{公式(#3#1#4)\;$\sim$\;(#5#2#6)}
\crefmultiformat{equation}{公式~(#2#1#3)}{ 和~(#2#1#3)}{，(#2#1#3)}{ 和~(#2#1#3)}
% equation, chapter, section, etc.
% \creflabelformat{htypei}{hformati}

% --------------------------- equations&principles settings ------------------------
% required packages:
% - amsthm
\newtheorem{theory}{定理}[section]
\newtheorem{law}{定律}[section]
\theoremstyle{definition}
%\def\lq{`}\def\rq{'}


% --------------------------- header&footer settings ----------------------
% required packages:
% - fancyhdr
% \pagestyle{fancy}
\fancyhf{}  % cleans original header&footer
\fancyhead[CE]{\xiaowu \xmutitle}
\fancyhead[CO]{\xiaowu \CTEXthechapter\quad\leftmark}  %
\fancyfoot[C]{\thepage}  % adds number of current page as footer


% --------------------------- TOC settings ---------------------------
% required packages:
% - hyperref[bookmarks=true,bookmarksnumbered=false,colorlinks,linkcolor=black,citecolor=blue,urlcolor=green]
\pdfstringdefDisableCommands{  % disable some definations
	\def\Dotfill{ }  % disable \Dotfill in toc of 
}








% --------------------------- TOC Arrangements ------------------------
\makeatletter

\newcommand\Dotfill{\leavevmode\cleaders\hb@xt@ .68em{\hss .\hss }\hfill\kern\z@}
%\newcommand\Dotfill{}

% for chapter
\newcommand\@chaplable[1]{第\zhnumber{#1}章}
\renewcommand\chapter{\if@openright\cleardoublepage\else\clearpage\fi
%	\thispagestyle{fancy}
	\global\@topnum\z@
%	\@afterindentfalse
	\secdef\@chapter\@schapter}
\renewcommand\@chapter[3][default]{%
	\ifnum \c@secnumdepth >\m@ne
	\if@mainmatter
	\refstepcounter{chapter}%
	\typeout{第\thechapter 章}% 
	\addcontentsline{toc}{chapter}%
	{\protect\numberline{\@chaplable{\thechapter}}\hspace{-2.5em}#1 \Dotfill }%
	\addcontentsline{eoc}{chapter}%
	{\protect\numberline{\bfseries \chaptername \bfseries \thechapter }\hspace{-1.7em} \textbf{#3} \Dotfill }%
	\else
	\addcontentsline{toc}{chapter}{#1}%
	\addcontentsline{eoc}{chapter}{\textbf{#3}}%
	\fi
	\else
	\addcontentsline{toc}{chapter}{#1}%
	\addcontentsline{eoc}{chapter}{\textbf{#3}}%
	\fi
	\chaptermark{#1}%
	\addtocontents{lof}{\protect\addvspace{10\p@}}%
	\addtocontents{lot}{\protect\addvspace{10\p@}}%
	\if@twocolumn
	\@topnewpage[\@makechapterhead{#2}]%
	\else
	\@makechapterhead{#2}%
	\@afterheading
	\fi}
\def\@makechapterhead#1{%
	\vspace*{10\p@}%
	{\parindent \z@ \raggedright \normalfont
		\ifnum \c@secnumdepth >\m@ne
		\if@mainmatter
		\vspace{-4ex}
		\centering \sffamily \bfseries \xiaosan  \@chaplable{\thechapter}\hspace{2ex} \vspace{2ex}
		\fi
		\fi
		\interlinepenalty\@M
		#1\par\nobreak
		\vskip 10\p@
}}

\def\@schapter#1{%
	\if@twocolumn
	\@topnewpage[\@makeschapterhead{#1}]%
	\else
	\@makeschapterhead{#1}%
	\@afterheading
	\fi%
}

\def\@makeschapterhead#1{%
	\vspace*{10\p@}%
	{\parindent \z@ \raggedright
		\interlinepenalty\@M
		\centering \sffamily \bfseries \xiaosan #1\par\nobreak
		\vskip 10\p@
	}%
}

\renewcommand*\l@chapter[2]{%
	\ifnum \c@tocdepth >\m@ne
	\addpenalty{-\@highpenalty}%
	\vskip -0.7em \@plus\p@  %目录章的间距
	\setlength\@tempdima{7em}%
	\begingroup
	\parindent \z@ \rightskip \@pnumwidth
	\parfillskip -\@pnumwidth
	\leavevmode \heiti \sihao %\sffamily
	\advance\leftskip\@tempdima
	\hskip -\leftskip
	#1\nobreak\hfil\xiaosi \heiti \nobreak\hb@xt@\@pnumwidth{\hss  #2}\par % \rmfamily
	\penalty\@highpenalty
	\endgroup
	\fi%
}
\renewcommand*\l@section[2]{\@dottedtocline{1}{2.0em}{3.0em}%
	{\heiti %\sffamily 
	\hspace{\xmusectionskip}	 \xiaosi #1}{ #2}}
\renewcommand*\l@subsection[2]{\@dottedtocline{2}{2.0em}{3.0em}%
	{%\heiti %\sffamily  %\rmfamily 
	\hspace{\xmusubsectionskip}	\xiaosi #1}{#2}}
% for section
\renewcommand\section[2]{%
	\refstepcounter{section}
	\addcontentsline{toc}{section}%
	{\protect\numberline{\thesection}#1}%
	\addcontentsline{eoc}{section}%
	{\protect\numberline{\bfseries \thesection \quad \;\; #2}}%
	\sectionmark{#1}%
	\par\vspace{3.5ex \@plus 1ex \@minus -.2ex}%
	{%
		\parindent \z@ \raggedright
		\interlinepenalty\@M
	\heiti	%\sffamily 
		\sihao \thesection \hspace{1.2em}#1\par\nobreak%
	}% section 标题设置
	\vspace{1.5ex}% section 标题后的间距
}
%
\renewcommand\subsection[2]{%
	\refstepcounter{subsection}
	\addcontentsline{toc}{subsection}%
	{\protect\numberline{\thesubsection}#1}%
	\addcontentsline{eoc}{subsection}%
	{\protect\numberline{\thesubsection}#2}%
	\par\vspace{2.25ex\@plus 1ex \@minus -.2ex}%
	{%
		\parindent \z@ \raggedright
		\interlinepenalty\@M
	\heiti	%\sffamily
		\xiaosi \thesubsection\phantom{m} #1\par\nobreak%
	}%  subsection 标题设置
	\vspace{1.5ex}% subsection 标题后的间距
}
%
\renewcommand\subsubsection{\@startsection{subsubsection}{3}{\z@}%
	{1.5ex}%
	{1.5ex \@plus .2ex}%
	{\sffamily
		\xiaosi}}
%

\renewcommand\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
	\thispagestyle{empty}%
	\hbox{}\newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}


%%用于产生没有编号但在目录中列出的章。
%% \phantomsection is the anchor hyperref needed to make a bookmark,
%% without it, hyerref would throw out warnings.
%% typeset Chinese Chapter, then list it in toc and eoc
\newcommand\CNchapter[2]{%
	\chapter*{\phantomsection %
		\center{#1}}%
	\markboth{#1}{}%
	\addcontentsline{toc}{chapter}{#1}%
	\addcontentsline{eoc}{chapter}{#2}%
}
%% typeset English Chapter, then list it in toc and eoc
\newcommand\ENchapter[2]{%
	\chapter*{\phantomsection %
		\center{#2}}%
	\markboth{#2}{}%
	\addcontentsline{toc}{chapter}{#1}%
	\addcontentsline{eoc}{chapter}{#2}%
}
%% Chinese Chapter only in toc
\newcommand\Cchapter[1]{%
	\chapter*{\phantomsection %
		\center{#1}}%
	\markboth{#1}{}%
	\addcontentsline{toc}{chapter}{#1}%
}
%% English Chapter only in eoc
\newcommand\Echapter[1]{%
	\chapter*{\phantomsection %
		\center{#1}}%
	\markboth{#1}{}%
	\addcontentsline{eoc}{chapter}{\textbf{#1}}%
}
%

%%===========================目录==============================%%

%%设置目录格式。
\renewcommand\tableofcontents{%
	\thispagestyle{plain}
	\if@twocolumn
	\@restonecoltrue\onecolumn
	\else
	\@restonecolfalse
	\fi
	\begingroup
	\parskip 0pt
	%    \Cchapter{\texorpdfstring{\contentsname}{目录}}%
	\begin{center}
          \textbf{\sffamily \xiaosan 目录}
	\end{center}
	\@starttoc{toc}% 
	\if@openright
\cleardoublepage
	\else
\clearpage
	\fi
	%   \ENchapter{英文目录}{\econtentsname}%
	\thispagestyle{plain}
	\begin{center}
		\xiaosan{ \textbf{Table of Contents}}
	\end{center}
	\@starttoc{eoc}%
	\endgroup
	\if@restonecol\twocolumn\fi%
	\cleardoublepage%
}

%%============================关键词===========================%%

%%中文关键词。
\newcommand\keywords[1]{%
	\vspace{2ex}\noindent{\sffamily \bfseries 关键词：} #1}


%%英文关键词。
\newcommand\englishkeywords[1]{%
	\vspace{2ex}\noindent{\sffamily \bfseries Keywords:} #1}

\makeatother
